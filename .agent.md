# Agent Configuration for merTools R Package

## Overview
This file documents the agent configuration and workflow for maintaining the 
merTools R package. It enables AI agents to understand how to validate code
changes without breaking the package.

## Quick Start

### For Any Code Change
1. Run unit tests: `Rscript -e "devtools::test()"`
2. Build package: `R CMD BUILD merTools`
3. Check package: `R CMD CHECK --no-manual merTools_*.tar.gz`

### Before Merging to Main
- Run the full check pipeline above
- Verify all checks show "Status: OK"
- Ensure 0 errors and 0 warnings

## Available Skills

### r-package-validation.sk
The primary skill for package validation. Provides:
- Validation strategies (full-build-check, run-tests, quick-check)
- Critical files list
- Common issues and solutions
- Commands for building/checking/installing
- Verification steps

### r-cmd-check-detailed.sk
Advanced skill for detailed R CMD CHECK interpretation. Use when:
- Full error analysis needed
- Check failures need debugging
- Preparing for CRAN submission

## Key Commands

```bash
# Build package from source
R CMD BUILD merTools

# Run checks (non-interactive, no manual)
R CMD CHECK --no-manual merTools_*.tar.gz

# Install locally for testing
R CMD INSTALL merTools_*.tar.gz

# Run tests with devtools
Rscript -e "devtools::test()"

# Regenerate documentation (after R file changes)
Rscript -e "devtools::document()"
```

## File Structure

```
.Rbuildignore          # Files excluded from build (e.g., .Rhistory, revdep/)
README.Rmd             # Source for README.md (not in build)
vignettes/*.Rmd.orig   # Original vignette sources
vignettes/precompile.R # Expands .orig files for build

R/                     # 13 source files
tests/testthat-a_m.R   # Tests A-M (testthat filter)
tests/testthat-m_z.R   # Tests N-Z (testthat filter)

DESCRIPTION            # Package metadata
NAMESPACE              # Auto-generated exports
man/*.Rd               # Auto-generated documentation
```

## Validation Checklist

### Build Phase
- [ ] Package builds without errors: `R CMD BUILD merTools`
- [ ] No unexpected files excluded (check .Rbuildignore)
- [ ] DESCRIPTION is valid

### Test Phase
- [ ] All unit tests pass: `Rscript -e "devtools::test()"`
- [ ] No test failures in check output
- [ ] Status: OK in check summary

### Check Phase
- [ ] No ERROR lines in check log
- [ ] No WARNING lines (or only acceptable notes)
- [ ] Examples run without errors
- [ ] Vignettes build successfully

## Common Issues & Fixes

### Issue:Roxygen errors after R file changes
**Fix:** `Rscript -e "devtools::document()"` before building

### Issue:Tests fail after code changes
**Fix:** 
1. Run `devtools::test()` locally to debug
2. Check test expectations match new behavior
3. Update tests if behavior changed intentionally

### Issue:Vignettes fail to build
**Fix:**
1. Check vignettes/precompile.R for API key dependencies
2. Ensure knitr and rmarkdown are installed
3. Examine vignette Rmd files for errors

### Issue:Dependency not found
**Fix:**
1. Check DESCRIPTION Imports/Suggests fields
2. Install missing packages manually
3. Verify package name is correct

## Development Workflow

### Feature Branch Development
1. Make changes in R/
2. Run quick check: `R CMD BUILD . && Rscript -e "devtools::test()"`
3. If passes, commit changes
4. Rebuild and run full check before PR

### PR Preparation
1. Update documentation: `Rscript -e "devtools::document()"`
2. Run full build: `R CMD BUILD merTools`
3. Full check: `R CMD CHECK --no-manual merTools_*.tar.gz`
4. Verify Status: OK
5. Check 0 errors, 0 warnings

### CRAN Submission Prep
1. Run full check without --no-manual flag
2. Verify all CRAN checklist items pass
3. Check vignettes build with examples
4. Ensure testing timing checks out

## Test Suite Structure

The test suite uses testthat with two main files:
- `tests/testthat-a_m.R` - Tests functions A-M
- `tests/testthat-m_z.R` - Tests functions N-Z

Tests are split alphabetically for organizational purposes.
Both files use `test_check()` with filter patterns.

## Integration Points

### GitHub Actions
Automated checks run on: `.github/workflows/check-standard.yaml`
- Triggers: All pushes and pull requests
- Platforms: macOS, Windows, Ubuntu (devel/release/oldrel)
- Uses r-lib/actions R-CMD-check workflow

### Local Development
Use the commands in this file for iterative development.

## References

- R Packages: https://r-pkgs.org/
- testthat: https://testthat.r-lib.org/
- CRAN repository policies: https://cran.r-project.org/web/packages/policies.html
